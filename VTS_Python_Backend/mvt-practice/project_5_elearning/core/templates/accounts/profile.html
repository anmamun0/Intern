{% extends "base.html" %}
{% load static %}

{% block title %}Profile | E-Learning{% endblock %}

{% block content %}
<div class="  mx-auto pb-20  ">

  <!-- Profile Container -->
  <div class="md:flex gap-8" x-data="{ activeEnrollment: null }">

    <!-- Left Column: User Info -->
    <div class="md:w-1/3 space-y-6">

      <!-- Profile Card -->
      <div class="bg-white/30 backdrop-blur-xl border border-white/40 rounded-2xl shadow-xl">
        <!-- Profile Image -->
        <div class="relative flex flex-col items-center px-6 pt-6">
          <!-- Decorative Grid Pattern -->
          <div class="absolute inset-0 opacity-10 ">
            <div class="absolute inset-0 "
              style="background-image: linear-gradient(#4f46e5 1px, transparent 1px), linear-gradient(90deg, #4f46e5 1px, transparent 1px); background-size: 20px 20px;">
            </div>
          </div>
          <div class="flex flex-col justify-center items-center text-center pt-3">

            {% if user.profile_image %}
            <div class="relative group ">
              <img src="{{ user.profile_image.url }}" alt="{{ user.username }}"
                class="w-36 h-36 rounded-full border-4 border-indigo-400/50 shadow-lg object-cover">
              <div
                class="absolute inset-0 rounded-full bg-indigo-500/0 group-hover:bg-indigo-500/10 transition-all duration-300">
              </div>
            </div>
            {% else %}
            <div class="relative group">
              <img src="{% static 'images/default_profile.png' %}" alt="Default Profile"
                class="w-36 h-36 rounded-full border-4 border-indigo-400/50 shadow-lg object-cover">
              <div
                class="absolute inset-0 rounded-full bg-indigo-500/0 group-hover:bg-indigo-500/10 transition-all duration-300">
              </div>
            </div>
            {% endif %}


            <div class="flex-col">
              <h2 class="text-2xl font-bold text-gray-800 mt-4">{{ user.first_name }} {{ user.last_name }}</h2>
              <!-- Role Badge -->
              <div class="mt-3 px-4 py-1.5 bg-indigo-500/20 backdrop-blur-sm border border-indigo-300/40 rounded-full">
                <span class=" flex gap-3 text-sm font-semibold text-indigo-700 capitalize">{{ user.role }} <p
                    class="text-gray-500 text-sm lowercase">@{{ user.username }}</p></span>
              </div>
            </div>
          </div>



        </div>

        <div class="mt-6 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent "></div>

        <!-- User Info -->
        <div class="mt-6 space-y-3 px-6">
          <div class="flex items-start gap-3 group">
            <svg class="w-5 h-5 text-gray-400 mt-0.5 group-hover:text-indigo-500 transition" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            <div class="flex-1 min-w-0">
              <p class="text-xs text-gray-500 uppercase tracking-wide">Email</p>
              <p class="text-sm text-gray-700 truncate">{{ user.email }}</p>
            </div>
          </div>

          <div class="flex items-start gap-3 group">
            <svg class="w-5 h-5 text-gray-400 mt-0.5 group-hover:text-indigo-500 transition" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            <div class="flex-1">
              <p class="text-xs text-gray-500 uppercase tracking-wide">Phone</p>
              <p class="text-sm text-gray-700">{{ user.phone_number|default:'Not provided' }}</p>
            </div>
          </div>

          <div class="flex items-start gap-3 group">
            <svg class="w-5 h-5 text-gray-400 mt-0.5 group-hover:text-indigo-500 transition" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <div class="flex-1">
              <p class="text-xs text-gray-500 uppercase tracking-wide">Date of Birth</p>
              <p class="text-sm text-gray-700">{{ user.date_of_birth|date:"F j, Y"|default:'Not provided' }}</p>
            </div>
          </div>

          {% if user.roll %}
          <div class="flex items-start gap-3 group">
            <svg class="w-5 h-5 text-gray-400 mt-0.5 group-hover:text-indigo-500 transition" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
            </svg>
            <div class="flex-1">
              <p class="text-xs text-gray-500 uppercase tracking-wide">Roll</p>
              <p class="text-sm text-gray-700">{{ user.roll }}</p>
            </div>
          </div>
          {% endif %}

          {% if user.register_id %}
          <div class="flex items-start gap-3 group">
            <svg class="w-5 h-5 text-gray-400 mt-0.5 group-hover:text-indigo-500 transition" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
            </svg>
            <div class="flex-1">
              <p class="text-xs text-gray-500 uppercase tracking-wide">Register ID</p>
              <p class="text-sm text-gray-700">{{ user.register_id }}</p>
            </div>
          </div>
          {% endif %}

          <div class="flex items-start gap-3 group">
            <svg class="w-5 h-5 text-gray-400 mt-0.5 group-hover:text-indigo-500 transition" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div class="flex-1">
              <p class="text-xs text-gray-500 uppercase tracking-wide">Joined</p>
              <p class="text-sm text-gray-700">{{ user.date_joined|date:"F j, Y" }}</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-6 space-y-2 p-6">
          <a href="#"
            class="block px-4 py-3 bg-indigo-500/90 backdrop-blur-sm text-white text-center rounded-xl hover:bg-indigo-600 transition-all duration-300 shadow-lg hover:shadow-xl font-medium">
            Edit Profile
          </a>
          <a href="{% url 'logout' %}"
            class="block px-4 py-3 bg-white/50 backdrop-blur-sm text-gray-700 text-center rounded-xl hover:bg-white/70 transition-all duration-300 border border-gray-200 font-medium">
            Logout
          </a>
        </div>
      </div>

      <!-- Bio Card (if exists) -->
      {% if user.bio %}
      <div class="bg-white/30 backdrop-blur-xl border border-white/40 rounded-3xl p-6 shadow-xl">
        <div class="flex items-center gap-2 mb-3">
          <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <h4 class="font-semibold text-gray-700">About</h4>
        </div>
        <p class="text-sm text-gray-600 leading-relaxed">{{ user.bio }}</p>
      </div>
      {% endif %}

    </div>

    <!-- Right Column: Role-Based Dashboard -->
    <div class="md:flex-1 mt-6 md:mt-0 space-y-6" x-data="{ activeCourse: null }">

      <!-- Student Dashboard -->
      {% if user.role == 'student' %}
      <section class="space-y-6">

        <!-- Header -->
        <div class="bg-white/30 backdrop-blur-xl border border-white/40 rounded-xl p-6 shadow-md">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="p-2 bg-indigo-500/20 rounded-2xl">
                <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-gray-800">My Courses</h3>
              </div>
            </div>

            <!-- Stats -->
            <div class="text-right">
              <div class="flex gap-3 items-center">
                <div>
                  <p class="text-sm text-gray-500">Enrolled</p>
                  <div class="text-xs text-gray-500 uppercase tracking-wide">Active</div>
                </div>
                <div class="text-2xl font-bold text-indigo-600">{{ enrolled_courses|length }}</div>
              </div>
            </div>
          </div>
        </div>

        {% if enrolled_courses %}
        <!-- Enrolled Courses -->
        <div class="space-y-4">
          {% for enrolled in enrolled_courses %}
          <div x-show="!activeCourse || activeCourse === {{ enrolled.id }}"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform scale-95"
            x-transition:enter-end="opacity-100 transform scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 transform scale-100"
            x-transition:leave-end="opacity-0 transform scale-95"
            class="bg-white/40 backdrop-blur-xl border border-white/50 rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300">

            <!-- Compact View -->
            <div @click="activeCourse = activeCourse === {{ enrolled.id }} ? null : {{ enrolled.id }}"
              class="p-6 cursor-pointer hover:bg-white/60 transition-colors">
              <div class="flex items-start justify-between gap-4">
                <div class="flex-1 min-w-0">
                  <!-- Course Title -->
                  <h4 class="font-bold text-gray-900 text-xl mb-2 truncate">{{ enrolled.course.title }}</h4>

                  <!-- Mentor Info -->
                  <div class="flex items-center gap-2 mb-3">
                    <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
                      <span class="text-xs font-semibold text-indigo-600">
                         {{ enrolled.course.mentor.first_name|first }} {{ enrolled.course.mentor.last_name|first }}</span>
                    </div>
                    <div>
                      <p class="text-sm text-gray-600">{{ enrolled.course.mentor.first_name }} 
                         {{ enrolled.course.mentor.last_name }}</p>
                      <p class="text-xs text-gray-400">Mentor</p>
                    </div>
                  </div>

                  <!-- Progress Bar -->
                  <div class="space-y-1">
                    <div class="flex items-center justify-between text-sm">
                      <span class="text-gray-600 font-medium">Progress</span>
                      <span class="text-indigo-600 font-bold">{{ enrolled.progress_percent|default:0 }}%</span>
                    </div>
                    <div class="w-full bg-gray-200/80 backdrop-blur-sm rounded-full h-3 overflow-hidden">
                      <div class="bg-indigo-500 h-3 rounded-full transition-all duration-700 relative overflow-hidden"
                        style="width: {{ enrolled.progress_percent|default:0 }}%">
                        <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Expand/Collapse Icon -->
                <div class="flex-shrink-0">
                  <div class="p-2 rounded-xl bg-white/50 backdrop-blur-sm hover:bg-white/80 transition">
                    <svg class="w-6 h-6 text-indigo-600 transition-transform duration-300"
                      :class="activeCourse === {{ enrolled.id }} ? 'rotate-180' : ''" fill="none" stroke="currentColor"
                      viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <!-- Expanded View (Chapters & Contents) -->
            <div x-show="activeCourse === {{ enrolled.id }}" x-transition:enter="transition ease-out duration-300"
              x-transition:enter-start="opacity-0 transform -translate-y-4"
              x-transition:enter-end="opacity-100 transform translate-y-0"
              x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
              x-transition:leave-end="opacity-0" class="px-6 pb-6 space-y-3">

              <div class="h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent mb-4"></div>

              {% for chapter in enrolled.course.chapters.all %}
              <div
                class="bg-white/60 backdrop-blur-sm rounded-2xl overflow-hidden border border-white/60 hover:border-indigo-200 transition-all"
                x-data="{ showContent: false }">
                <div @click="showContent = !showContent" class="p-4 cursor-pointer hover:bg-white/80 transition-colors">
                  <div class="flex items-center justify-between">
                    <div class="flex-1">
                      <div class="flex items-center gap-3 mb-1">
                        <span class="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs font-bold rounded-lg">{{ chapter.order }}</span>
                        <h5 class="font-semibold text-gray-800 text-lg">{{ chapter.title }}</h5>
                      </div>
                      <p class="text-sm text-gray-600 ml-12">{{ chapter.description }}</p>
                    </div>
                    <svg class="w-5 h-5 text-gray-400 transition-transform flex-shrink-0 ml-4"
                      :class="showContent ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                </div>

                <div x-show="showContent" x-transition class="px-4 pb-4">
                  <div class="ml-12 space-y-2 pl-4 border-l-2 border-indigo-200">
                    {% for content in chapter.contents.all %}
                    <a href="{{ content.video_url }}" target="_blank"
                      class="flex items-center gap-3 p-2 rounded-lg hover:bg-indigo-50/80 transition-colors group">
                      <div
                        class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center group-hover:bg-indigo-200 transition">
                        <svg class="w-4 h-4 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                          <path
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" />
                        </svg>
                      </div>
                      <span class="text-sm text-gray-700 group-hover:text-indigo-600 transition font-medium">
                        {{ content.order }}. {{ content.title }}
                      </span>
                    </a>
                    {% empty %}
                    <p class="text-gray-400 italic text-sm text-center py-3">No content available yet</p>
                    {% endfor %}
                  </div>
                </div>
              </div>
              {% empty %}
              <p class="text-gray-400 text-center py-3">No chapters available</p>
              {% endfor %}

              <!-- Continue Learning Button -->
              <div class="pt-4">
                <button
                  class="w-full py-3 bg-indigo-500/90 backdrop-blur-sm text-white font-semibold rounded-xl hover:bg-indigo-600 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
                  <span>Continue Learning</span>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13 7l5 5m0 0l-5 5m5-5H6" />
                  </svg>
                </button>
              </div>

            </div>
          </div>
          {% endfor %}
        </div>

        {% else %}
        <div class="bg-white/30 backdrop-blur-xl border border-white/40 rounded-3xl p-12 text-center shadow-xl">
          <h4 class="text-xl font-semibold text-gray-700 mb-2">No Courses Yet</h4>
          <p class="text-gray-500 mb-6">You haven't enrolled in any courses. Start your learning journey today!</p>
          <a href="#"
            class="inline-block px-6 py-3 bg-indigo-500/90 text-white font-semibold rounded-xl hover:bg-indigo-600 transition-all duration-300 shadow-lg">
            Browse Courses
          </a>
        </div>
        {% endif %}

      </section>
      {% else %}


      {% if user.role == 'mentor' %}
      <section class="space-y-6" x-data="{ 
        activeTab: 'courses',
        openStudent: null, 
        notification: { show: false, message: '', type: '' } 
      }">
        <!-- Header -->
        <div class="bg-white/30 backdrop-blur-xl border border-white/40 rounded-xl p-6 shadow-md flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="p-3 bg-indigo-500/20 rounded-2xl">
              <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
              </svg>
            </div>
            <div>
              <h3 class="text-2xl font-bold text-gray-800">Mentor Dashboard</h3>
              <p class="text-sm text-gray-500">{{ uploaded_courses|length }} courses created</p>
            </div>
          </div>

          <a href="{% url 'course_create' %}"  class="px-4 py-2 bg-indigo-500/90 text-white text-sm font-medium rounded-xl hover:bg-indigo-600 transition-all duration-300 shadow-lg">
            + Create Course
          </a>
        </div>

        <!-- Notification Toast -->
        <div x-show="notification.show"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-2"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white font-medium z-50"
             :class="notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'"
             style="display: none;">
          <span x-text="notification.message"></span>
        </div>

        <!-- Tab Buttons -->
        <div class="flex gap-3 mb-6">
          <!-- Courses Tab -->
          <button @click="activeTab = 'courses'"
            class="flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-xl transition-all duration-300 shadow-lg"
            :class="activeTab === 'courses' ? 'bg-indigo-600 text-white' : 'bg-white/60 text-indigo-600 hover:bg-white/80'">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
            <span>My Courses</span>
          </button>

          <!-- Enrolled Students Tab -->
          <button @click="activeTab = 'students'"
            class="flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-xl transition-all duration-300 shadow-lg"
            :class="activeTab === 'students' ? 'bg-indigo-600 text-white' : 'bg-white/60 text-indigo-600 hover:bg-white/80'">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M17 20h5v-2a3 3 0 0 0-5.356-1.857M9 20H4v-2a3 3 0 0 1 5.356-1.857M12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm6 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM6 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
            </svg>
            <span>Your Students</span>
          </button>
        </div>

        <!-- My Courses Section -->
        <div x-show="activeTab === 'courses'"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-x-4"
             x-transition:enter-end="opacity-100 transform translate-x-0">
          {% if uploaded_courses %}
          <!-- Mentor Courses Grid -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4">
            {% for course in uploaded_courses %}
            <div
              class="bg-white/40 backdrop-blur-xl border border-white/50 rounded-3xl p-6 shadow-lg hover:shadow-2xl transition-all duration-300 group">
              <div class="flex items-start justify-between mb-4">
                <div class="p-3 bg-indigo-100/80 rounded-2xl group-hover:bg-indigo-200/80 transition">
                  <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                  </svg>
                </div>
                <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-lg">Active</span>
              </div>

              <h4 class="font-bold text-gray-900 text-lg mb-4 line-clamp-2">{{ course.title }}</h4>

              <div class="space-y-3 mb-4">
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-600">Students</span>
                  <span class="font-semibold text-gray-800">{{ course.get_student }}</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-600">Revenue</span>
                  <span class="font-semibold text-indigo-600">${{ course.revenue|default:0 }}</span>
                </div>
              </div>

              <div class="h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent mb-4"></div>

              <a href="#"
                class="flex items-center justify-center gap-2 w-full py-2.5 bg-white/60 backdrop-blur-sm text-indigo-600 font-medium rounded-xl hover:bg-white/80 transition-all duration-300 border border-indigo-200">
                <span>Manage Course</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
              </a>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <!-- No Courses Message -->
          <div class="bg-white/30 backdrop-blur-xl border border-white/40 rounded-3xl p-12 text-center shadow-xl">
            <svg class="w-20 h-20 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
            <h4 class="text-xl font-semibold text-gray-700 mb-2">No Courses Yet</h4>
            <p class="text-gray-500 mb-6">Start creating courses and share your knowledge with students worldwide!</p>
            <a href="{% url 'create_course' %}"
              class="inline-block px-6 py-3 bg-indigo-500/90 text-white font-semibold rounded-xl hover:bg-indigo-600 transition-all duration-300 shadow-lg">
              Create Your First Course
            </a>
          </div>
          {% endif %}
        </div>

        <!-- My Students Section -->
        <div x-show="activeTab === 'students'"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-x-4"
             x-transition:enter-end="opacity-100 transform translate-x-0"
             style="display: none;"
             class="mt-8">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">Enrolled Students</h3>

          {% if enrolled %}
          <div class="bg-white/40 backdrop-blur-xl border border-white/50 rounded-xl shadow-lg overflow-hidden">
            <table class="w-full">
              <thead class="bg-indigo-500/20">
                <tr>
                  <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Student Email</th>
                  <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Name</th>
                  <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Total Courses</th>
                  <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Actions</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200/50">
                {% regroup enrolled by student as student_list %}
                {% for student_group in student_list %}
                <tr class="hover:bg-white/30 transition-colors cursor-pointer" 
                    @click="openStudent = openStudent === {{ forloop.counter }} ? null : {{ forloop.counter }}">
                  <td class="px-6 py-4 text-sm text-gray-800">
                    <div class="flex items-center gap-2">
                      <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                      </svg>
                      {{ student_group.grouper.email }}
                    </div>
                  </td>
                  <td class="px-6 py-4 text-sm font-medium text-gray-800">
                    {{ student_group.grouper.first_name }} {{ student_group.grouper.last_name }}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-600">
                    <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full font-semibold">
                      {{ student_group.list|length }} course{{ student_group.list|length|pluralize }}
                    </span>
                  </td>
                  <td class="px-6 py-4 text-sm">
                    <svg class="w-5 h-5 text-gray-400 transition-transform duration-200" 
                         :class="{ 'rotate-180': openStudent === {{ forloop.counter }} }"
                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </td>
                </tr>
                
                <!-- Dropdown Row -->
                <tr x-show="openStudent === {{ forloop.counter }}"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 transform -translate-y-2"
                    x-transition:enter-end="opacity-100 transform translate-y-0"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    style="display: none;">
                  <td colspan="4" class="px-6 py-0">
                    <div class="bg-gradient-to-r from-indigo-50/50 to-purple-50/50 rounded-lg p-4 my-2">
                      <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                        Enrolled Courses
                      </h4>
                      <div class="space-y-2">
                        {% for enrollment in student_group.list %}
                        <div class="flex items-center justify-between bg-white/60 backdrop-blur-sm rounded-lg p-3 border border-white/80 shadow-sm"
                             x-data="{ isActive: true }">
                          <div class="flex items-center gap-3 flex-1">
                            <div class="p-2 bg-indigo-100/80 rounded-lg">
                              <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                              </svg>
                            </div>
                            <div>
                              <p class="font-medium text-gray-800">{{ enrollment.course.title }}</p>
                              <p class="text-xs text-gray-500">Enrolled: {{ enrollment.enrolled_at|date:"M d, Y" }}</p>
                            </div>
                          </div>
                          
                          <!-- Active/Deactive Toggle -->
                          <div class="flex items-center gap-2" @click.stop>
                            <label class="relative inline-flex items-center cursor-pointer">
                              <input type="checkbox" 
                                     class="sr-only peer" 
                                     x-model="isActive"
                                     @change="toggleEnrollment({{ enrollment.id }}, isActive)">
                              <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                              <span class="ml-3 text-sm font-medium text-gray-700" x-text="isActive ? 'Active' : 'Inactive'"></span>
                            </label>
                          </div>
                        </div>
                        {% endfor %}
                      </div>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="bg-white/30 backdrop-blur-xl border border-white/40 rounded-xl p-8 text-center shadow-lg">
            <svg class="w-16 h-16 text-gray-300 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <p class="text-gray-500 text-lg">No enrolled students yet</p>
          </div>
          {% endif %}
        </div>

        <script>
        function toggleEnrollment(enrollmentId, isActive) {
          fetch(`/update-enrollment-status/${enrollmentId}/`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
              is_active: isActive
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              showNotification(isActive ? 'Course activated successfully' : 'Course deactivated successfully', 'success');
            } else {
              showNotification('Failed to update status', 'error');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            showNotification('An error occurred', 'error');
          });
        }

        function showNotification(message, type) {
          const event = new CustomEvent('show-notification', {
            detail: { message, type }
          });
          window.dispatchEvent(event);
        }

        function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
              }
            }
          }
          return cookieValue;
        }

        // Listen for notification events
        window.addEventListener('show-notification', (e) => {
          const container = document.querySelector('section[x-data]');
          if (container && container.__x) {
            container.__x.$data.notification = {
              show: true,
              message: e.detail.message,
              type: e.detail.type
            };
            
            setTimeout(() => {
              container.__x.$data.notification.show = false;
            }, 3000);
          }
        });
        </script>

      </section>
      {% endif %}
      {% endif %}







    </div>


  </div>
</div>

<style>
  /* Custom animations */
  @keyframes pulse {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: .5;
    }
  }

  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  /* Line clamp utility */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Custom scrollbar for webkit browsers */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb {
    background: rgba(99, 102, 241, 0.5);
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(99, 102, 241, 0.7);
  }
</style>

{% endblock %}